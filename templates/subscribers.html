<!DOCTYPE html>
<html lang="en" class="h-full" x-data="{ darkMode: localStorage.getItem('theme') === 'dark' }" :class="{ 'dark': darkMode }">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SageAlpha.ai â€” Subscribers</title>
  
  <!-- Tailwind CSS 3.x CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            sage: {
              50: '#faf5ff',
              100: '#f3e8ff',
              200: '#e9d5ff',
              300: '#d8b4fe',
              400: '#c084fc',
              500: '#a855f7',
              600: '#9333ea',
              700: '#7c3aed',
              800: '#6b21a8',
              900: '#581c87',
              950: '#3b0764',
            },
            primary: '#8B5CF6',
          },
          fontFamily: {
            display: ['Clash Display', 'system-ui', 'sans-serif'],
            sans: ['Satoshi', 'Inter', 'system-ui', 'sans-serif'],
          },
        }
      }
    }
  </script>
  
  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    @import url('https://api.fontshare.com/v2/css?f[]=satoshi@400,500,700&f[]=clash-display@600,700&display=swap');
    body { font-family: 'Satoshi', 'Inter', system-ui, sans-serif; }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }
    
    .dark .glass-card {
      background: rgba(30, 41, 59, 0.9);
    }
    
    .input-glow:focus {
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
    }
    
    @keyframes slide-up {
      from { transform: translateY(10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .animate-slide-up {
      animation: slide-up 0.3s ease-out;
    }
  </style>
</head>

<body class="h-full bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 transition-colors duration-300">
  
  <div x-data="subscribersApp()" x-init="init()" class="h-full flex flex-col">
    
    <!-- Top Navigation -->
    <header class="bg-white/80 dark:bg-slate-900/90 backdrop-blur-xl sticky top-0 z-50 border-b border-slate-200/50 dark:border-slate-800/50">
      <div class="flex items-center justify-between px-6 h-16">
        <div class="flex items-center gap-3">
          <a href="/" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
            <img src="{{ url_for('static', filename='img/sagealpha-logo.png') }}"
                 alt="SageAlpha" class="h-8 w-auto" onerror="this.style.display='none'">
            <span class="font-display font-bold text-lg">SageAlpha</span>
          </a>
          <span class="text-xs bg-sage-100 dark:bg-sage-900/50 text-sage-700 dark:text-sage-300 px-2 py-0.5 rounded-full font-medium">
            v{{ APP_VERSION }}
          </span>
        </div>
        
        <div class="flex items-center gap-3">
          <button @click="toggleTheme()"
                  class="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
            <svg x-show="!darkMode" class="w-5 h-5 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
            </svg>
            <svg x-show="darkMode" class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: none;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
          </button>
          <a href="/portfolio" class="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors" title="Back to Portfolio">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
          </a>
          <a href="/" class="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
            </svg>
          </a>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-auto p-6">
      <div class="max-w-2xl mx-auto">
        
        <!-- Success Message -->
        {% if success_message %}
        <div class="mb-6 p-4 bg-green-100 dark:bg-green-900/50 border border-green-300 dark:border-green-700 rounded-xl flex items-start gap-3 animate-slide-up">
          <svg class="w-5 h-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
          <div>
            <p class="text-green-800 dark:text-green-200 font-medium">{{ success_message }}</p>
          </div>
        </div>
        {% endif %}
        
        <!-- Page Header -->
        <div class="text-center mb-8">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-sage-500 to-sage-700 mb-4 shadow-xl shadow-sage-500/30">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
          </div>
          <h1 class="text-3xl font-display font-bold text-slate-900 dark:text-white mb-2">Subscribers</h1>
          <p class="text-slate-600 dark:text-slate-400">Add subscribers who should receive the approved reports.</p>
        </div>
        
        <!-- Add Subscriber Card -->
        <div class="glass-card rounded-2xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 p-6 mb-6">
          <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
            <svg class="w-5 h-5 text-sage-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
            </svg>
            Add New Subscriber
          </h2>
          
          <form method="POST" action="{{ url_for('portfolio.add_subscriber_route') }}" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Full Name</label>
              <input type="text" 
                     name="name" 
                     required
                     class="w-full px-4 py-3 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none input-glow transition-all"
                     placeholder="John Smith">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Mobile Number</label>
              <input type="tel" 
                     name="mobile"
                     class="w-full px-4 py-3 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none input-glow transition-all"
                     placeholder="+1 (555) 123-4567">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Email Address</label>
              <input type="email" 
                     name="email" 
                     required
                     class="w-full px-4 py-3 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none input-glow transition-all"
                     placeholder="john@company.com">
            </div>
            
            <button type="submit"
                    class="w-full py-3 px-4 bg-gradient-to-r from-sage-500 to-sage-600 hover:from-sage-600 hover:to-sage-700 text-white font-semibold rounded-xl shadow-lg shadow-sage-500/25 transition-all flex items-center justify-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
              </svg>
              Add Subscriber
            </button>
          </form>
        </div>
        
        <!-- Subscribers List -->
        {% if subscribers %}
        <div class="glass-card rounded-2xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 p-6 mb-6">
          <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
            <svg class="w-5 h-5 text-sage-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
            Current Subscribers
            <span class="ml-auto text-sm font-normal text-slate-500">{{ subscribers|length }} total</span>
          </h2>
          
          <div class="space-y-3">
            {% for sub in subscribers %}
            <div class="flex items-center justify-between bg-slate-50 dark:bg-slate-800/50 rounded-xl p-4 border border-slate-200 dark:border-slate-700">
              <div class="flex items-center gap-4 flex-1">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-sage-400 to-sage-600 flex items-center justify-center text-white font-semibold text-sm">
                  {{ sub.name[:1].upper() }}
                </div>
                <div class="flex-1">
                  <p class="font-medium text-slate-900 dark:text-white">{{ sub.name }}</p>
                  <p class="text-sm text-slate-500 dark:text-slate-400">{{ sub.email }}</p>
                  {% if sub.mobile %}
                  <p class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">{{ sub.mobile }}</p>
                  {% endif %}
                </div>
              </div>
              <div class="flex items-center gap-2">
                <!-- Edit Button -->
                <button @click="openEditModal({{ sub.id }}, {{ sub.name|tojson }}, {{ sub.email|tojson }}, {{ (sub.mobile or '')|tojson }})"
                        class="p-2 text-sage-600 dark:text-sage-400 hover:bg-sage-100 dark:hover:bg-sage-900/50 rounded-lg transition-colors"
                        title="Edit subscriber">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                </button>
                <!-- Delete Button -->
                <form method="POST" action="{{ url_for('portfolio.delete_subscriber_route') }}" 
                      onsubmit="return confirm('Are you sure you want to delete this subscriber?');"
                      class="inline">
                  <input type="hidden" name="subscriber_id" value="{{ sub.id }}">
                  <button type="submit"
                          class="p-2 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/50 rounded-lg transition-colors"
                          title="Delete subscriber">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                  </button>
                </form>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        
        <!-- Send Reports Button -->
        <form method="POST" action="{{ url_for('portfolio.send_reports') }}">
          <button type="submit"
                  class="w-full py-4 px-6 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white text-lg font-semibold rounded-xl shadow-lg shadow-green-500/25 transition-all flex items-center justify-center gap-3">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
            Send Reports
          </button>
        </form>
        {% else %}
        <!-- Empty State -->
        <div class="glass-card rounded-2xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 p-8 text-center">
          <svg class="w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
          </svg>
          <p class="text-slate-600 dark:text-slate-400 mb-2">No subscribers yet</p>
          <p class="text-sm text-slate-500">Add subscribers above to distribute your approved reports.</p>
        </div>
        {% endif %}
        
        <!-- Back Link -->
        <div class="mt-6 text-center">
          <a href="{{ url_for('portfolio.portfolio') }}" class="inline-flex items-center gap-2 text-sage-600 dark:text-sage-400 hover:text-sage-700 dark:hover:text-sage-300 font-medium transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            Back to Portfolio
          </a>
        </div>
      </div>
    </main>
    
    <!-- Edit Subscriber Modal -->
    <div x-show="editModalOpen"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
         style="display: none;"
         @click.self="editModalOpen = false">
      
      <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl max-w-md w-full"
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 scale-95"
           x-transition:enter-end="opacity-100 scale-100">
        
        <!-- Modal Header -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200 dark:border-slate-700">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Edit Subscriber</h3>
          <button @click="editModalOpen = false; editingSubscriberId = null"
                  class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        
        <!-- Modal Content -->
        <form method="POST" action="{{ url_for('portfolio.edit_subscriber_route') }}" class="p-6 space-y-4">
          <input type="hidden" name="subscriber_id" :value="editingSubscriberId">
          
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Full Name</label>
            <input type="text" 
                   name="name"
                   x-model="editName"
                   required
                   class="w-full px-4 py-3 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none input-glow transition-all">
          </div>
          
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Mobile Number</label>
            <input type="tel" 
                   name="mobile"
                   x-model="editMobile"
                   class="w-full px-4 py-3 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none input-glow transition-all"
                   placeholder="+1 (555) 123-4567">
          </div>
          
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Email Address</label>
            <input type="email" 
                   name="email"
                   x-model="editEmail"
                   required
                   class="w-full px-4 py-3 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none input-glow transition-all"
                   placeholder="john@company.com">
          </div>
          
          <!-- Modal Footer -->
          <div class="flex justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-700">
            <button type="button"
                    @click="editModalOpen = false; editingSubscriberId = null"
                    class="px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-800 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
              Cancel
            </button>
            <button type="submit"
                    class="px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-sage-500 to-sage-600 rounded-lg hover:from-sage-600 hover:to-sage-700 transition-colors">
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>
  </div>

  <script>
    function subscribersApp() {
      return {
        darkMode: localStorage.getItem('theme') === 'dark',
        editModalOpen: false,
        editingSubscriberId: null,
        editName: '',
        editEmail: '',
        editMobile: '',
        
        init() {
          this.applyTheme();
        },
        
        toggleTheme() {
          this.darkMode = !this.darkMode;
          localStorage.setItem('theme', this.darkMode ? 'dark' : 'light');
          this.applyTheme();
        },
        
        applyTheme() {
          if (this.darkMode) {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
        },
        
        openEditModal(subscriberId, name, email, mobile) {
          this.editingSubscriberId = subscriberId;
          this.editName = name;
          this.editEmail = email;
          this.editMobile = mobile || '';
          this.editModalOpen = true;
        }
      };
    }
  </script>
</body>
</html>

